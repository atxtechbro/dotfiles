#!/bin/bash
# MCP (Model Context Protocol) related aliases and functions

# Setup MCP configuration for different personas
alias mcp-setup-personal="~/ppv/pillars/dotfiles/mcp/setup.sh --persona personal"
alias mcp-setup-company="~/ppv/pillars/dotfiles/mcp/setup.sh --persona company"

# List active MCP servers
mcp-list() {
  echo "Active MCP servers:"
  ps aux | grep -E 'github-mcp-server|mcp-atlassian' | grep -v grep
}

# Start a specific MCP server manually
mcp-start() {
  local server=$1
  
  if [ -z "$server" ]; then
    echo "Usage: mcp-start <server-name>"
    echo "Available servers: github, atlassian"
    return 1
  fi
  
  case "$server" in
    github)
      npx -y @github/github-mcp-server &
      echo "Started GitHub MCP server"
      ;;
    atlassian)
      if [ -z "$ATLASSIAN_BASE_URL" ]; then
        echo "Error: ATLASSIAN_BASE_URL environment variable not set"
        return 1
      fi
      npx -y @sooperset/mcp-atlassian --baseUrl "$ATLASSIAN_BASE_URL" &
      echo "Started Atlassian MCP server"
      ;;
    *)
      echo "Unknown server: $server"
      echo "Available servers: github, atlassian"
      return 1
      ;;
  esac
}

# Stop all running MCP servers
mcp-stop-all() {
  pkill -f 'github-mcp-server|mcp-atlassian' || echo "No MCP servers running"
}

# Edit MCP configuration for different AI assistants
alias mcp-edit-amazonq="$EDITOR ~/.amazonq/mcp.json"
alias mcp-edit-claude="$EDITOR ~/.config/claude/mcp.json"

# View MCP configuration for different AI assistants
alias mcp-cat-amazonq="cat ~/.amazonq/mcp.json"
alias mcp-cat-claude="cat ~/.config/claude/mcp.json"

# Check if MCP servers are configured correctly
mcp-check() {
  echo "Checking MCP configuration..."
  
  # Check Amazon Q configuration
  if [ -f ~/.amazonq/mcp.json ]; then
    echo "✅ Amazon Q MCP configuration found"
    echo "   Configured servers:"
    grep -o '"[^"]*": {' ~/.amazonq/mcp.json | sed 's/": {//' | sed 's/"//g' | sed 's/^/   - /'
  else
    echo "❌ Amazon Q MCP configuration not found"
    echo "   Run 'mcp-setup-personal' or 'mcp-setup-company' to set it up"
  fi
  
  # Check Claude configuration
  if [ -f ~/.config/claude/mcp.json ]; then
    echo "✅ Claude MCP configuration found"
    echo "   Configured servers:"
    grep -o '"[^"]*": {' ~/.config/claude/mcp.json | sed 's/": {//' | sed 's/"//g' | sed 's/^/   - /'
  else
    echo "❌ Claude MCP configuration not found"
    echo "   Run 'mcp-setup-personal' or 'mcp-setup-company' to set it up"
  fi
  
  # Check for running MCP servers
  echo ""
  echo "Running MCP servers:"
  mcp_servers=$(ps aux | grep -E 'github-mcp-server|mcp-atlassian' | grep -v grep)
  if [ -z "$mcp_servers" ]; then
    echo "   No MCP servers currently running"
  else
    echo "$mcp_servers" | awk '{print "   - " $NF}'
  fi
}
