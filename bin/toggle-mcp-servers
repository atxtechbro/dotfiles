#!/bin/bash
# Toggle git and github MCP servers on/off for testing
# See issue #1213

SETTINGS_FILE="$HOME/.claude/settings.json"

if [ ! -f "$SETTINGS_FILE" ]; then
    echo "Error: Settings file not found at $SETTINGS_FILE"
    exit 1
fi

case "$1" in
    off)
        echo "Disabling git and github MCP servers..."
        # Comment out the MCP servers
        sed -i 's/^    "git",/    \/\/ "git",      \/\/ Temporarily disabled for testing - see issue #1213/' "$SETTINGS_FILE"
        sed -i 's/^    "github",/    \/\/ "github",   \/\/ Temporarily disabled for testing - see issue #1213/' "$SETTINGS_FILE"
        sed -i 's/^      "mcp__git",/      \/\/ "mcp__git",     \/\/ Temporarily disabled for testing - see issue #1213/' "$SETTINGS_FILE"
        sed -i 's/^      "mcp__github",/      \/\/ "mcp__github",  \/\/ Temporarily disabled for testing - see issue #1213/' "$SETTINGS_FILE"
        echo "✓ MCP servers disabled - using CLI directly"
        echo "  Please restart Claude Code for changes to take effect"
        ;;
    on)
        echo "Enabling git and github MCP servers..."
        # Uncomment the MCP servers
        sed -i 's/^    \/\/ "git",.*$/    "git",/' "$SETTINGS_FILE"
        sed -i 's/^    \/\/ "github",.*$/    "github",/' "$SETTINGS_FILE"
        sed -i 's/^      \/\/ "mcp__git",.*$/      "mcp__git",/' "$SETTINGS_FILE"
        sed -i 's/^      \/\/ "mcp__github",.*$/      "mcp__github",/' "$SETTINGS_FILE"
        echo "✓ MCP servers enabled"
        echo "  Please restart Claude Code for changes to take effect"
        ;;
    status)
        echo "Checking MCP server status..."
        if grep -q '^\s*"git",' "$SETTINGS_FILE"; then
            echo "  git MCP: ENABLED"
        else
            echo "  git MCP: DISABLED"
        fi
        if grep -q '^\s*"github",' "$SETTINGS_FILE"; then
            echo "  github MCP: ENABLED"
        else
            echo "  github MCP: DISABLED"
        fi
        ;;
    *)
        echo "Usage: toggle-mcp-servers [on|off|status]"
        echo ""
        echo "  on     - Enable git and github MCP servers"
        echo "  off    - Disable git and github MCP servers (use CLI directly)"
        echo "  status - Show current status of MCP servers"
        echo ""
        echo "After toggling, restart Claude Code for changes to take effect."
        echo "See issue #1213 for details on this experiment."
        exit 1
        ;;
esac