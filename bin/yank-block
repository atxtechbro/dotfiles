#!/bin/bash
# yank-block: Copy structured blocks of text to clipboard from any terminal
# Works in both tmux and regular terminal sessions

# Check if we're in tmux
if [ -n "$TMUX" ]; then
  # We're in tmux, use tmux commands
  tmux copy-mode
  tmux send-keys "0v/^$/e-1" C-m
  echo "Block yanked to clipboard (tmux)"
else
  # We're not in tmux, use terminal-based approach with temporary file
  TEMP_FILE=$(mktemp)
  
  # Save current cursor position
  tput sc
  
  # Find the next empty line
  current_line=$(tput cup)
  next_empty_line=$(awk 'NR>'$current_line' && /^$/ {print NR; exit}' "$(tty)")
  
  # If no empty line found, use end of file
  if [ -z "$next_empty_line" ]; then
    next_empty_line=$(wc -l < "$(tty)")
  fi
  
  # Extract the text block
  sed -n "${current_line},${next_empty_line}p" "$(tty)" > "$TEMP_FILE"
  
  # Copy to clipboard using available clipboard tool
  if command -v xclip &> /dev/null; then
    cat "$TEMP_FILE" | xclip -selection clipboard
  elif command -v pbcopy &> /dev/null; then
    cat "$TEMP_FILE" | pbcopy
  elif command -v clip.exe &> /dev/null; then
    cat "$TEMP_FILE" | clip.exe
  fi
  
  # Clean up
  rm "$TEMP_FILE"
  
  # Restore cursor position
  tput rc
  
  echo "Block yanked to clipboard"
fi
