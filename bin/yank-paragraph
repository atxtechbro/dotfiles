#!/bin/bash
# yank-paragraph: Copy paragraph (text between empty lines) to clipboard
# Works in both tmux and regular terminal sessions

# Check if we're in tmux
if [ -n "$TMUX" ]; then
  # We're in tmux, use tmux commands
  tmux copy-mode
  tmux send-keys "{jv}k" C-m
  echo "Paragraph yanked to clipboard (tmux)"
else
  # We're not in tmux, use terminal-based approach with temporary file
  TEMP_FILE=$(mktemp)
  
  # Save current cursor position
  tput sc
  
  # Find the paragraph boundaries
  current_line=$(tput cup)
  
  # Find start of paragraph (previous empty line + 1)
  start_line=$(awk 'NR<'$current_line' && /^$/ {line=NR+1} END {print line}' "$(tty)")
  if [ -z "$start_line" ]; then
    start_line=1
  fi
  
  # Find end of paragraph (next empty line - 1)
  end_line=$(awk 'NR>'$current_line' && /^$/ {print NR-1; exit}' "$(tty)")
  if [ -z "$end_line" ]; then
    end_line=$(wc -l < "$(tty)")
  fi
  
  # Extract the paragraph
  sed -n "${start_line},${end_line}p" "$(tty)" > "$TEMP_FILE"
  
  # Copy to clipboard using available clipboard tool
  if command -v xclip &> /dev/null; then
    cat "$TEMP_FILE" | xclip -selection clipboard
  elif command -v pbcopy &> /dev/null; then
    cat "$TEMP_FILE" | pbcopy
  elif command -v clip.exe &> /dev/null; then
    cat "$TEMP_FILE" | clip.exe
  fi
  
  # Clean up
  rm "$TEMP_FILE"
  
  # Restore cursor position
  tput rc
  
  echo "Paragraph yanked to clipboard"
fi
